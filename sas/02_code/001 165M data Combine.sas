libname datadir "F:\shire_followup\data\dataset_165M";
libname outdir "F:\shire_followup\data";

data outdir.Datset_i1;
	set datadir.Datset_i1_1 - datadir.Datset_i1_21;
	if AGE < 0 then delete;
run;

data outdir.Datset_i2;
	set datadir.Datset_i2_1 - datadir.Datset_i2_61;
	if AGE < 0 then delete;
run;

data outdir.Datset_i3;
	set datadir.Datset_i3_1 - datadir.Datset_i3_101;
run;

proc sql;
create table qc_165M as
	select "dataset1" as dat, count(*) as totalcnt from outdir.Datset_i1
	union all
	select "dataset2" as dat, count(*) as totalcnt from outdir.Datset_i2
	union all
	select "dataset3" as dat, count(*) as totalcnt from outdir.Datset_i3;
quit;

data i1;
	set outdir.datset_i1(obs=10);
run;

data i2;
	set outdir.datset_i2(obs=10);
run;

data i3;
	set outdir.datset_i3(obs=10);
run;

data i4;
	set outdir.Final_data_clean(obs=10);
run;

data all;
	set i1 i2 i3 i4;
run;

proc sql;
create table outdir.dataset_II as
	select d.patient_id,
			d.DIAG_1_FLAG,
			d.DIAG_2_FLAG,
			d.DIAG_3_FLAG,
			d.DIAG_4_FLAG,
			d.DIAG_5_FLAG,
			d.DIAG_6_FLAG,
			d.DIAG_7_FLAG,
			d.DIAG_8_FLAG,
			d.DIAG_9_FLAG,
			d.DIAG_10_FLAG,
			d.DIAG_11_FLAG,
			d.DIAG_12_FLAG,
			d.DIAG_13_FLAG,
			d.DIAG_14_FLAG,
			d.DIAG_15_FLAG,
			d.DIAG_16_FLAG,
			d.DIAG_17_FLAG,
			d.DIAG_18_FLAG,
			d.DIAG_19_FLAG,
			d.DIAG_20_FLAG,
			d.DIAG_21_FLAG,
			d.DIAG_22_FLAG,
			d.DIAG_23_FLAG,
			d.DIAG_24_FLAG,
			d.DIAG_25_FLAG,
			d.DIAG_26_FLAG,
			d.DIAG_27_FLAG,
			d.DIAG_28_FLAG,
			d.DIAG_29_FLAG,
			d.DIAG_30_FLAG,
			d.DIAG_31_FLAG,
			d.DIAG_32_FLAG,
			d.DIAG_33_FLAG,
			d.DIAG_34_FLAG,
			d.DIAG_35_FLAG,
			d.DIAG_36_FLAG,
			d.DIAG_37_FLAG,
			d.DIAG_38_FLAG,
			d.DIAG_39_FLAG,
			d.DIAG_40_FLAG,
			d.DIAG_41_FLAG,
			d.DIAG_42_FLAG,
			d.DIAG_43_FLAG,
			d.DIAG_44_FLAG,
			d.DIAG_45_FLAG,
			d.DIAG_46_FLAG,
			d.DIAG_47_FLAG,
			d.DIAG_48_FLAG,
			d.DIAG_49_FLAG,
			d.DIAG_50_FLAG,
			d.DIAG_51_FLAG,
			d.DIAG_52_FLAG,
			d.DIAG_53_FLAG,
			d.DIAG_54_FLAG,
			d.DIAG_55_FLAG,
			d.DIAG_56_FLAG,
			d.DIAG_57_FLAG,
			d.DIAG_58_FLAG,
			d.PRC_59_FLAG,
			d.PRC_60_FLAG,
			d.PRC_61_FLAG,
			d.PRC_62_FLAG,
			d.PRC_63_FLAG,
			d.PRC_64_FLAG,
			d.PRC_65_FLAG,
			d.PRC_66_FLAG,
			d.RX_67_FLAG,
			d.RX_68_FLAG,
			d.RX_69_FLAG,
			d.RX_70_FLAG,
			d.RX_71_FLAG,
			d.RX_72_FLAG,
			d.RX_73_FLAG,
			d.RX_74_FLAG,
			d.RX_75_FLAG,
			d.RX_76_FLAG,
			d.RX_77_FLAG,
			d.RX_78_FLAG,
			d.DIAG_1_FREQ,
			d.DIAG_2_FREQ,
			d.DIAG_3_FREQ,
			d.DIAG_4_FREQ,
			d.DIAG_5_FREQ,
			d.DIAG_6_FREQ,
			d.DIAG_7_FREQ,
			d.DIAG_8_FREQ,
			d.DIAG_9_FREQ,
			d.DIAG_10_FREQ,
			d.DIAG_11_FREQ,
			d.DIAG_12_FREQ,
			d.DIAG_13_FREQ,
			d.DIAG_14_FREQ,
			d.DIAG_15_FREQ,
			d.DIAG_16_FREQ,
			d.DIAG_17_FREQ,
			d.DIAG_18_FREQ,
			d.DIAG_19_FREQ,
			d.DIAG_20_FREQ,
			d.DIAG_21_FREQ,
			d.DIAG_22_FREQ,
			d.DIAG_23_FREQ,
			d.DIAG_24_FREQ,
			d.DIAG_25_FREQ,
			d.DIAG_26_FREQ,
			d.DIAG_27_FREQ,
			d.DIAG_28_FREQ,
			d.DIAG_29_FREQ,
			d.DIAG_30_FREQ,
			d.DIAG_31_FREQ,
			d.DIAG_32_FREQ,
			d.DIAG_33_FREQ,
			d.DIAG_34_FREQ,
			d.DIAG_35_FREQ,
			d.DIAG_36_FREQ,
			d.DIAG_37_FREQ,
			d.DIAG_38_FREQ,
			d.DIAG_39_FREQ,
			d.DIAG_40_FREQ,
			d.DIAG_41_FREQ,
			d.DIAG_42_FREQ,
			d.DIAG_43_FREQ,
			d.DIAG_44_FREQ,
			d.DIAG_45_FREQ,
			d.DIAG_46_FREQ,
			d.DIAG_47_FREQ,
			d.DIAG_48_FREQ,
			d.DIAG_49_FREQ,
			d.DIAG_50_FREQ,
			d.DIAG_51_FREQ,
			d.DIAG_52_FREQ,
			d.DIAG_53_FREQ,
			d.DIAG_54_FREQ,
			d.DIAG_55_FREQ,
			d.DIAG_56_FREQ,
			d.DIAG_57_FREQ,
			d.DIAG_58_FREQ,
			d.PRC_59_FREQ,
			d.PRC_60_FREQ,
			d.PRC_61_FREQ,
			d.PRC_62_FREQ,
			d.PRC_63_FREQ,
			d.PRC_64_FREQ,
			d.PRC_65_FREQ,
			d.PRC_66_FREQ,
			d.RX_67_FREQ,
			d.RX_68_FREQ,
			d.RX_69_FREQ,
			d.RX_70_FREQ,
			d.RX_71_FREQ,
			d.RX_72_FREQ,
			d.RX_73_FREQ,
			d.RX_74_FREQ,
			d.RX_75_FREQ,
			d.RX_76_FREQ,
			d.RX_77_FREQ,
			d.RX_78_FREQ,
			d.DIAG_1_AFREQ,
			d.DIAG_2_AFREQ,
			d.DIAG_3_AFREQ,
			d.DIAG_4_AFREQ,
			d.DIAG_5_AFREQ,
			d.DIAG_6_AFREQ,
			d.DIAG_7_AFREQ,
			d.DIAG_8_AFREQ,
			d.DIAG_9_AFREQ,
			d.DIAG_10_AFREQ,
			d.DIAG_11_AFREQ,
			d.DIAG_12_AFREQ,
			d.DIAG_13_AFREQ,
			d.DIAG_14_AFREQ,
			d.DIAG_15_AFREQ,
			d.DIAG_16_AFREQ,
			d.DIAG_17_AFREQ,
			d.DIAG_18_AFREQ,
			d.DIAG_19_AFREQ,
			d.DIAG_20_AFREQ,
			d.DIAG_21_AFREQ,
			d.DIAG_22_AFREQ,
			d.DIAG_23_AFREQ,
			d.DIAG_24_AFREQ,
			d.DIAG_25_AFREQ,
			d.DIAG_26_AFREQ,
			d.DIAG_27_AFREQ,
			d.DIAG_28_AFREQ,
			d.DIAG_29_AFREQ,
			d.DIAG_30_AFREQ,
			d.DIAG_31_AFREQ,
			d.DIAG_32_AFREQ,
			d.DIAG_33_AFREQ,
			d.DIAG_34_AFREQ,
			d.DIAG_35_AFREQ,
			d.DIAG_36_AFREQ,
			d.DIAG_37_AFREQ,
			d.DIAG_38_AFREQ,
			d.DIAG_39_AFREQ,
			d.DIAG_40_AFREQ,
			d.DIAG_41_AFREQ,
			d.DIAG_42_AFREQ,
			d.DIAG_43_AFREQ,
			d.DIAG_44_AFREQ,
			d.DIAG_45_AFREQ,
			d.DIAG_46_AFREQ,
			d.DIAG_47_AFREQ,
			d.DIAG_48_AFREQ,
			d.DIAG_49_AFREQ,
			d.DIAG_50_AFREQ,
			d.DIAG_51_AFREQ,
			d.DIAG_52_AFREQ,
			d.DIAG_53_AFREQ,
			d.DIAG_54_AFREQ,
			d.DIAG_55_AFREQ,
			d.DIAG_56_AFREQ,
			d.DIAG_57_AFREQ,
			d.DIAG_58_AFREQ,
			d.PRC_59_AFREQ,
			d.PRC_60_AFREQ,
			d.PRC_61_AFREQ,
			d.PRC_62_AFREQ,
			d.PRC_63_AFREQ,
			d.PRC_64_AFREQ,
			d.PRC_65_AFREQ,
			d.PRC_66_AFREQ,
			d.RX_67_AFREQ,
			d.RX_68_AFREQ,
			d.RX_69_AFREQ,
			d.RX_70_AFREQ,
			d.RX_71_AFREQ,
			d.RX_72_AFREQ,
			d.RX_73_AFREQ,
			d.RX_74_AFREQ,
			d.RX_75_AFREQ,
			d.RX_76_AFREQ,
			d.RX_77_AFREQ,
			d.RX_78_AFREQ,
			d.GENDERM,
			d.AGE,
			d.lookback_days,
			d.ER_FREQ,
			d.ER_AFREQ,
			d.ER_FLAG,
			"95M" as datasource from outdir.Final_data_clean d
	union all
	select a.patient_id,
			a.DIAG_1_FLAG,
			a.DIAG_2_FLAG,
			a.DIAG_3_FLAG,
			a.DIAG_4_FLAG,
			a.DIAG_5_FLAG,
			a.DIAG_6_FLAG,
			a.DIAG_7_FLAG,
			a.DIAG_8_FLAG,
			a.DIAG_9_FLAG,
			a.DIAG_10_FLAG,
			a.DIAG_11_FLAG,
			a.DIAG_12_FLAG,
			a.DIAG_13_FLAG,
			a.DIAG_14_FLAG,
			a.DIAG_15_FLAG,
			a.DIAG_16_FLAG,
			a.DIAG_17_FLAG,
			a.DIAG_18_FLAG,
			a.DIAG_19_FLAG,
			a.DIAG_20_FLAG,
			a.DIAG_21_FLAG,
			a.DIAG_22_FLAG,
			a.DIAG_23_FLAG,
			a.DIAG_24_FLAG,
			a.DIAG_25_FLAG,
			a.DIAG_26_FLAG,
			a.DIAG_27_FLAG,
			a.DIAG_28_FLAG,
			a.DIAG_29_FLAG,
			a.DIAG_30_FLAG,
			a.DIAG_31_FLAG,
			a.DIAG_32_FLAG,
			a.DIAG_33_FLAG,
			a.DIAG_34_FLAG,
			a.DIAG_35_FLAG,
			a.DIAG_36_FLAG,
			a.DIAG_37_FLAG,
			a.DIAG_38_FLAG,
			a.DIAG_39_FLAG,
			a.DIAG_40_FLAG,
			a.DIAG_41_FLAG,
			a.DIAG_42_FLAG,
			a.DIAG_43_FLAG,
			a.DIAG_44_FLAG,
			a.DIAG_45_FLAG,
			a.DIAG_46_FLAG,
			a.DIAG_47_FLAG,
			a.DIAG_48_FLAG,
			a.DIAG_49_FLAG,
			a.DIAG_50_FLAG,
			a.DIAG_51_FLAG,
			a.DIAG_52_FLAG,
			a.DIAG_53_FLAG,
			a.DIAG_54_FLAG,
			a.DIAG_55_FLAG,
			a.DIAG_56_FLAG,
			a.DIAG_57_FLAG,
			a.DIAG_58_FLAG,
			a.PRC_59_FLAG,
			a.PRC_60_FLAG,
			a.PRC_61_FLAG,
			a.PRC_62_FLAG,
			a.PRC_63_FLAG,
			a.PRC_64_FLAG,
			a.PRC_65_FLAG,
			a.PRC_66_FLAG,
			a.RX_67_FLAG,
			a.RX_68_FLAG,
			a.RX_69_FLAG,
			a.RX_70_FLAG,
			a.RX_71_FLAG,
			a.RX_72_FLAG,
			a.RX_73_FLAG,
			a.RX_74_FLAG,
			a.RX_75_FLAG,
			a.RX_76_FLAG,
			a.RX_77_FLAG,
			a.RX_78_FLAG,
			a.DIAG_1_FREQ,
			a.DIAG_2_FREQ,
			a.DIAG_3_FREQ,
			a.DIAG_4_FREQ,
			a.DIAG_5_FREQ,
			a.DIAG_6_FREQ,
			a.DIAG_7_FREQ,
			a.DIAG_8_FREQ,
			a.DIAG_9_FREQ,
			a.DIAG_10_FREQ,
			a.DIAG_11_FREQ,
			a.DIAG_12_FREQ,
			a.DIAG_13_FREQ,
			a.DIAG_14_FREQ,
			a.DIAG_15_FREQ,
			a.DIAG_16_FREQ,
			a.DIAG_17_FREQ,
			a.DIAG_18_FREQ,
			a.DIAG_19_FREQ,
			a.DIAG_20_FREQ,
			a.DIAG_21_FREQ,
			a.DIAG_22_FREQ,
			a.DIAG_23_FREQ,
			a.DIAG_24_FREQ,
			a.DIAG_25_FREQ,
			a.DIAG_26_FREQ,
			a.DIAG_27_FREQ,
			a.DIAG_28_FREQ,
			a.DIAG_29_FREQ,
			a.DIAG_30_FREQ,
			a.DIAG_31_FREQ,
			a.DIAG_32_FREQ,
			a.DIAG_33_FREQ,
			a.DIAG_34_FREQ,
			a.DIAG_35_FREQ,
			a.DIAG_36_FREQ,
			a.DIAG_37_FREQ,
			a.DIAG_38_FREQ,
			a.DIAG_39_FREQ,
			a.DIAG_40_FREQ,
			a.DIAG_41_FREQ,
			a.DIAG_42_FREQ,
			a.DIAG_43_FREQ,
			a.DIAG_44_FREQ,
			a.DIAG_45_FREQ,
			a.DIAG_46_FREQ,
			a.DIAG_47_FREQ,
			a.DIAG_48_FREQ,
			a.DIAG_49_FREQ,
			a.DIAG_50_FREQ,
			a.DIAG_51_FREQ,
			a.DIAG_52_FREQ,
			a.DIAG_53_FREQ,
			a.DIAG_54_FREQ,
			a.DIAG_55_FREQ,
			a.DIAG_56_FREQ,
			a.DIAG_57_FREQ,
			a.DIAG_58_FREQ,
			a.PRC_59_FREQ,
			a.PRC_60_FREQ,
			a.PRC_61_FREQ,
			a.PRC_62_FREQ,
			a.PRC_63_FREQ,
			a.PRC_64_FREQ,
			a.PRC_65_FREQ,
			a.PRC_66_FREQ,
			a.RX_67_FREQ,
			a.RX_68_FREQ,
			a.RX_69_FREQ,
			a.RX_70_FREQ,
			a.RX_71_FREQ,
			a.RX_72_FREQ,
			a.RX_73_FREQ,
			a.RX_74_FREQ,
			a.RX_75_FREQ,
			a.RX_76_FREQ,
			a.RX_77_FREQ,
			a.RX_78_FREQ,
			a.DIAG_1_AFREQ,
			a.DIAG_2_AFREQ,
			a.DIAG_3_AFREQ,
			a.DIAG_4_AFREQ,
			a.DIAG_5_AFREQ,
			a.DIAG_6_AFREQ,
			a.DIAG_7_AFREQ,
			a.DIAG_8_AFREQ,
			a.DIAG_9_AFREQ,
			a.DIAG_10_AFREQ,
			a.DIAG_11_AFREQ,
			a.DIAG_12_AFREQ,
			a.DIAG_13_AFREQ,
			a.DIAG_14_AFREQ,
			a.DIAG_15_AFREQ,
			a.DIAG_16_AFREQ,
			a.DIAG_17_AFREQ,
			a.DIAG_18_AFREQ,
			a.DIAG_19_AFREQ,
			a.DIAG_20_AFREQ,
			a.DIAG_21_AFREQ,
			a.DIAG_22_AFREQ,
			a.DIAG_23_AFREQ,
			a.DIAG_24_AFREQ,
			a.DIAG_25_AFREQ,
			a.DIAG_26_AFREQ,
			a.DIAG_27_AFREQ,
			a.DIAG_28_AFREQ,
			a.DIAG_29_AFREQ,
			a.DIAG_30_AFREQ,
			a.DIAG_31_AFREQ,
			a.DIAG_32_AFREQ,
			a.DIAG_33_AFREQ,
			a.DIAG_34_AFREQ,
			a.DIAG_35_AFREQ,
			a.DIAG_36_AFREQ,
			a.DIAG_37_AFREQ,
			a.DIAG_38_AFREQ,
			a.DIAG_39_AFREQ,
			a.DIAG_40_AFREQ,
			a.DIAG_41_AFREQ,
			a.DIAG_42_AFREQ,
			a.DIAG_43_AFREQ,
			a.DIAG_44_AFREQ,
			a.DIAG_45_AFREQ,
			a.DIAG_46_AFREQ,
			a.DIAG_47_AFREQ,
			a.DIAG_48_AFREQ,
			a.DIAG_49_AFREQ,
			a.DIAG_50_AFREQ,
			a.DIAG_51_AFREQ,
			a.DIAG_52_AFREQ,
			a.DIAG_53_AFREQ,
			a.DIAG_54_AFREQ,
			a.DIAG_55_AFREQ,
			a.DIAG_56_AFREQ,
			a.DIAG_57_AFREQ,
			a.DIAG_58_AFREQ,
			a.PRC_59_AFREQ,
			a.PRC_60_AFREQ,
			a.PRC_61_AFREQ,
			a.PRC_62_AFREQ,
			a.PRC_63_AFREQ,
			a.PRC_64_AFREQ,
			a.PRC_65_AFREQ,
			a.PRC_66_AFREQ,
			a.RX_67_AFREQ,
			a.RX_68_AFREQ,
			a.RX_69_AFREQ,
			a.RX_70_AFREQ,
			a.RX_71_AFREQ,
			a.RX_72_AFREQ,
			a.RX_73_AFREQ,
			a.RX_74_AFREQ,
			a.RX_75_AFREQ,
			a.RX_76_AFREQ,
			a.RX_77_AFREQ,
			a.RX_78_AFREQ,
			a.GENDERM,
			a.AGE,
			a.lookback_days,
			a.ER_FREQ,
			a.ER_AFREQ,
			a.ER_FLAG,
			"I1" as datasource from outdir.Datset_i1 a
	union all
	select b.patient_id,
			b.DIAG_1_FLAG,
			b.DIAG_2_FLAG,
			b.DIAG_3_FLAG,
			b.DIAG_4_FLAG,
			b.DIAG_5_FLAG,
			b.DIAG_6_FLAG,
			b.DIAG_7_FLAG,
			b.DIAG_8_FLAG,
			b.DIAG_9_FLAG,
			b.DIAG_10_FLAG,
			b.DIAG_11_FLAG,
			b.DIAG_12_FLAG,
			b.DIAG_13_FLAG,
			b.DIAG_14_FLAG,
			b.DIAG_15_FLAG,
			b.DIAG_16_FLAG,
			b.DIAG_17_FLAG,
			b.DIAG_18_FLAG,
			b.DIAG_19_FLAG,
			b.DIAG_20_FLAG,
			b.DIAG_21_FLAG,
			b.DIAG_22_FLAG,
			b.DIAG_23_FLAG,
			b.DIAG_24_FLAG,
			b.DIAG_25_FLAG,
			b.DIAG_26_FLAG,
			b.DIAG_27_FLAG,
			b.DIAG_28_FLAG,
			b.DIAG_29_FLAG,
			b.DIAG_30_FLAG,
			b.DIAG_31_FLAG,
			b.DIAG_32_FLAG,
			b.DIAG_33_FLAG,
			b.DIAG_34_FLAG,
			b.DIAG_35_FLAG,
			b.DIAG_36_FLAG,
			b.DIAG_37_FLAG,
			b.DIAG_38_FLAG,
			b.DIAG_39_FLAG,
			b.DIAG_40_FLAG,
			b.DIAG_41_FLAG,
			b.DIAG_42_FLAG,
			b.DIAG_43_FLAG,
			b.DIAG_44_FLAG,
			b.DIAG_45_FLAG,
			b.DIAG_46_FLAG,
			b.DIAG_47_FLAG,
			b.DIAG_48_FLAG,
			b.DIAG_49_FLAG,
			b.DIAG_50_FLAG,
			b.DIAG_51_FLAG,
			b.DIAG_52_FLAG,
			b.DIAG_53_FLAG,
			b.DIAG_54_FLAG,
			b.DIAG_55_FLAG,
			b.DIAG_56_FLAG,
			b.DIAG_57_FLAG,
			b.DIAG_58_FLAG,
			b.PRC_59_FLAG,
			b.PRC_60_FLAG,
			b.PRC_61_FLAG,
			b.PRC_62_FLAG,
			b.PRC_63_FLAG,
			b.PRC_64_FLAG,
			b.PRC_65_FLAG,
			b.PRC_66_FLAG,
			b.RX_67_FLAG,
			b.RX_68_FLAG,
			b.RX_69_FLAG,
			b.RX_70_FLAG,
			b.RX_71_FLAG,
			b.RX_72_FLAG,
			b.RX_73_FLAG,
			b.RX_74_FLAG,
			b.RX_75_FLAG,
			b.RX_76_FLAG,
			b.RX_77_FLAG,
			b.RX_78_FLAG,
			b.DIAG_1_FREQ,
			b.DIAG_2_FREQ,
			b.DIAG_3_FREQ,
			b.DIAG_4_FREQ,
			b.DIAG_5_FREQ,
			b.DIAG_6_FREQ,
			b.DIAG_7_FREQ,
			b.DIAG_8_FREQ,
			b.DIAG_9_FREQ,
			b.DIAG_10_FREQ,
			b.DIAG_11_FREQ,
			b.DIAG_12_FREQ,
			b.DIAG_13_FREQ,
			b.DIAG_14_FREQ,
			b.DIAG_15_FREQ,
			b.DIAG_16_FREQ,
			b.DIAG_17_FREQ,
			b.DIAG_18_FREQ,
			b.DIAG_19_FREQ,
			b.DIAG_20_FREQ,
			b.DIAG_21_FREQ,
			b.DIAG_22_FREQ,
			b.DIAG_23_FREQ,
			b.DIAG_24_FREQ,
			b.DIAG_25_FREQ,
			b.DIAG_26_FREQ,
			b.DIAG_27_FREQ,
			b.DIAG_28_FREQ,
			b.DIAG_29_FREQ,
			b.DIAG_30_FREQ,
			b.DIAG_31_FREQ,
			b.DIAG_32_FREQ,
			b.DIAG_33_FREQ,
			b.DIAG_34_FREQ,
			b.DIAG_35_FREQ,
			b.DIAG_36_FREQ,
			b.DIAG_37_FREQ,
			b.DIAG_38_FREQ,
			b.DIAG_39_FREQ,
			b.DIAG_40_FREQ,
			b.DIAG_41_FREQ,
			b.DIAG_42_FREQ,
			b.DIAG_43_FREQ,
			b.DIAG_44_FREQ,
			b.DIAG_45_FREQ,
			b.DIAG_46_FREQ,
			b.DIAG_47_FREQ,
			b.DIAG_48_FREQ,
			b.DIAG_49_FREQ,
			b.DIAG_50_FREQ,
			b.DIAG_51_FREQ,
			b.DIAG_52_FREQ,
			b.DIAG_53_FREQ,
			b.DIAG_54_FREQ,
			b.DIAG_55_FREQ,
			b.DIAG_56_FREQ,
			b.DIAG_57_FREQ,
			b.DIAG_58_FREQ,
			b.PRC_59_FREQ,
			b.PRC_60_FREQ,
			b.PRC_61_FREQ,
			b.PRC_62_FREQ,
			b.PRC_63_FREQ,
			b.PRC_64_FREQ,
			b.PRC_65_FREQ,
			b.PRC_66_FREQ,
			b.RX_67_FREQ,
			b.RX_68_FREQ,
			b.RX_69_FREQ,
			b.RX_70_FREQ,
			b.RX_71_FREQ,
			b.RX_72_FREQ,
			b.RX_73_FREQ,
			b.RX_74_FREQ,
			b.RX_75_FREQ,
			b.RX_76_FREQ,
			b.RX_77_FREQ,
			b.RX_78_FREQ,
			b.DIAG_1_AFREQ,
			b.DIAG_2_AFREQ,
			b.DIAG_3_AFREQ,
			b.DIAG_4_AFREQ,
			b.DIAG_5_AFREQ,
			b.DIAG_6_AFREQ,
			b.DIAG_7_AFREQ,
			b.DIAG_8_AFREQ,
			b.DIAG_9_AFREQ,
			b.DIAG_10_AFREQ,
			b.DIAG_11_AFREQ,
			b.DIAG_12_AFREQ,
			b.DIAG_13_AFREQ,
			b.DIAG_14_AFREQ,
			b.DIAG_15_AFREQ,
			b.DIAG_16_AFREQ,
			b.DIAG_17_AFREQ,
			b.DIAG_18_AFREQ,
			b.DIAG_19_AFREQ,
			b.DIAG_20_AFREQ,
			b.DIAG_21_AFREQ,
			b.DIAG_22_AFREQ,
			b.DIAG_23_AFREQ,
			b.DIAG_24_AFREQ,
			b.DIAG_25_AFREQ,
			b.DIAG_26_AFREQ,
			b.DIAG_27_AFREQ,
			b.DIAG_28_AFREQ,
			b.DIAG_29_AFREQ,
			b.DIAG_30_AFREQ,
			b.DIAG_31_AFREQ,
			b.DIAG_32_AFREQ,
			b.DIAG_33_AFREQ,
			b.DIAG_34_AFREQ,
			b.DIAG_35_AFREQ,
			b.DIAG_36_AFREQ,
			b.DIAG_37_AFREQ,
			b.DIAG_38_AFREQ,
			b.DIAG_39_AFREQ,
			b.DIAG_40_AFREQ,
			b.DIAG_41_AFREQ,
			b.DIAG_42_AFREQ,
			b.DIAG_43_AFREQ,
			b.DIAG_44_AFREQ,
			b.DIAG_45_AFREQ,
			b.DIAG_46_AFREQ,
			b.DIAG_47_AFREQ,
			b.DIAG_48_AFREQ,
			b.DIAG_49_AFREQ,
			b.DIAG_50_AFREQ,
			b.DIAG_51_AFREQ,
			b.DIAG_52_AFREQ,
			b.DIAG_53_AFREQ,
			b.DIAG_54_AFREQ,
			b.DIAG_55_AFREQ,
			b.DIAG_56_AFREQ,
			b.DIAG_57_AFREQ,
			b.DIAG_58_AFREQ,
			b.PRC_59_AFREQ,
			b.PRC_60_AFREQ,
			b.PRC_61_AFREQ,
			b.PRC_62_AFREQ,
			b.PRC_63_AFREQ,
			b.PRC_64_AFREQ,
			b.PRC_65_AFREQ,
			b.PRC_66_AFREQ,
			b.RX_67_AFREQ,
			b.RX_68_AFREQ,
			b.RX_69_AFREQ,
			b.RX_70_AFREQ,
			b.RX_71_AFREQ,
			b.RX_72_AFREQ,
			b.RX_73_AFREQ,
			b.RX_74_AFREQ,
			b.RX_75_AFREQ,
			b.RX_76_AFREQ,
			b.RX_77_AFREQ,
			b.RX_78_AFREQ,
			b.GENDERM,
			b.AGE,
			b.lookback_days,
			b.ER_FREQ,
			b.ER_AFREQ,
			b.ER_FLAG,
			"I2" as datasource from outdir.Datset_i2 b
	union all
	select c.patient_id,
			c.DIAG_1_FLAG,
			c.DIAG_2_FLAG,
			c.DIAG_3_FLAG,
			c.DIAG_4_FLAG,
			c.DIAG_5_FLAG,
			c.DIAG_6_FLAG,
			c.DIAG_7_FLAG,
			c.DIAG_8_FLAG,
			c.DIAG_9_FLAG,
			c.DIAG_10_FLAG,
			c.DIAG_11_FLAG,
			c.DIAG_12_FLAG,
			c.DIAG_13_FLAG,
			c.DIAG_14_FLAG,
			c.DIAG_15_FLAG,
			c.DIAG_16_FLAG,
			c.DIAG_17_FLAG,
			c.DIAG_18_FLAG,
			c.DIAG_19_FLAG,
			c.DIAG_20_FLAG,
			c.DIAG_21_FLAG,
			c.DIAG_22_FLAG,
			c.DIAG_23_FLAG,
			c.DIAG_24_FLAG,
			c.DIAG_25_FLAG,
			c.DIAG_26_FLAG,
			c.DIAG_27_FLAG,
			c.DIAG_28_FLAG,
			c.DIAG_29_FLAG,
			c.DIAG_30_FLAG,
			c.DIAG_31_FLAG,
			c.DIAG_32_FLAG,
			c.DIAG_33_FLAG,
			c.DIAG_34_FLAG,
			c.DIAG_35_FLAG,
			c.DIAG_36_FLAG,
			c.DIAG_37_FLAG,
			c.DIAG_38_FLAG,
			c.DIAG_39_FLAG,
			c.DIAG_40_FLAG,
			c.DIAG_41_FLAG,
			c.DIAG_42_FLAG,
			c.DIAG_43_FLAG,
			c.DIAG_44_FLAG,
			c.DIAG_45_FLAG,
			c.DIAG_46_FLAG,
			c.DIAG_47_FLAG,
			c.DIAG_48_FLAG,
			c.DIAG_49_FLAG,
			c.DIAG_50_FLAG,
			c.DIAG_51_FLAG,
			c.DIAG_52_FLAG,
			c.DIAG_53_FLAG,
			c.DIAG_54_FLAG,
			c.DIAG_55_FLAG,
			c.DIAG_56_FLAG,
			c.DIAG_57_FLAG,
			c.DIAG_58_FLAG,
			c.PRC_59_FLAG,
			c.PRC_60_FLAG,
			c.PRC_61_FLAG,
			c.PRC_62_FLAG,
			c.PRC_63_FLAG,
			c.PRC_64_FLAG,
			c.PRC_65_FLAG,
			c.PRC_66_FLAG,
			c.RX_67_FLAG,
			c.RX_68_FLAG,
			c.RX_69_FLAG,
			c.RX_70_FLAG,
			c.RX_71_FLAG,
			c.RX_72_FLAG,
			c.RX_73_FLAG,
			c.RX_74_FLAG,
			c.RX_75_FLAG,
			c.RX_76_FLAG,
			c.RX_77_FLAG,
			c.RX_78_FLAG,
			c.DIAG_1_FREQ,
			c.DIAG_2_FREQ,
			c.DIAG_3_FREQ,
			c.DIAG_4_FREQ,
			c.DIAG_5_FREQ,
			c.DIAG_6_FREQ,
			c.DIAG_7_FREQ,
			c.DIAG_8_FREQ,
			c.DIAG_9_FREQ,
			c.DIAG_10_FREQ,
			c.DIAG_11_FREQ,
			c.DIAG_12_FREQ,
			c.DIAG_13_FREQ,
			c.DIAG_14_FREQ,
			c.DIAG_15_FREQ,
			c.DIAG_16_FREQ,
			c.DIAG_17_FREQ,
			c.DIAG_18_FREQ,
			c.DIAG_19_FREQ,
			c.DIAG_20_FREQ,
			c.DIAG_21_FREQ,
			c.DIAG_22_FREQ,
			c.DIAG_23_FREQ,
			c.DIAG_24_FREQ,
			c.DIAG_25_FREQ,
			c.DIAG_26_FREQ,
			c.DIAG_27_FREQ,
			c.DIAG_28_FREQ,
			c.DIAG_29_FREQ,
			c.DIAG_30_FREQ,
			c.DIAG_31_FREQ,
			c.DIAG_32_FREQ,
			c.DIAG_33_FREQ,
			c.DIAG_34_FREQ,
			c.DIAG_35_FREQ,
			c.DIAG_36_FREQ,
			c.DIAG_37_FREQ,
			c.DIAG_38_FREQ,
			c.DIAG_39_FREQ,
			c.DIAG_40_FREQ,
			c.DIAG_41_FREQ,
			c.DIAG_42_FREQ,
			c.DIAG_43_FREQ,
			c.DIAG_44_FREQ,
			c.DIAG_45_FREQ,
			c.DIAG_46_FREQ,
			c.DIAG_47_FREQ,
			c.DIAG_48_FREQ,
			c.DIAG_49_FREQ,
			c.DIAG_50_FREQ,
			c.DIAG_51_FREQ,
			c.DIAG_52_FREQ,
			c.DIAG_53_FREQ,
			c.DIAG_54_FREQ,
			c.DIAG_55_FREQ,
			c.DIAG_56_FREQ,
			c.DIAG_57_FREQ,
			c.DIAG_58_FREQ,
			c.PRC_59_FREQ,
			c.PRC_60_FREQ,
			c.PRC_61_FREQ,
			c.PRC_62_FREQ,
			c.PRC_63_FREQ,
			c.PRC_64_FREQ,
			c.PRC_65_FREQ,
			c.PRC_66_FREQ,
			c.RX_67_FREQ,
			c.RX_68_FREQ,
			c.RX_69_FREQ,
			c.RX_70_FREQ,
			c.RX_71_FREQ,
			c.RX_72_FREQ,
			c.RX_73_FREQ,
			c.RX_74_FREQ,
			c.RX_75_FREQ,
			c.RX_76_FREQ,
			c.RX_77_FREQ,
			c.RX_78_FREQ,
			c.DIAG_1_AFREQ,
			c.DIAG_2_AFREQ,
			c.DIAG_3_AFREQ,
			c.DIAG_4_AFREQ,
			c.DIAG_5_AFREQ,
			c.DIAG_6_AFREQ,
			c.DIAG_7_AFREQ,
			c.DIAG_8_AFREQ,
			c.DIAG_9_AFREQ,
			c.DIAG_10_AFREQ,
			c.DIAG_11_AFREQ,
			c.DIAG_12_AFREQ,
			c.DIAG_13_AFREQ,
			c.DIAG_14_AFREQ,
			c.DIAG_15_AFREQ,
			c.DIAG_16_AFREQ,
			c.DIAG_17_AFREQ,
			c.DIAG_18_AFREQ,
			c.DIAG_19_AFREQ,
			c.DIAG_20_AFREQ,
			c.DIAG_21_AFREQ,
			c.DIAG_22_AFREQ,
			c.DIAG_23_AFREQ,
			c.DIAG_24_AFREQ,
			c.DIAG_25_AFREQ,
			c.DIAG_26_AFREQ,
			c.DIAG_27_AFREQ,
			c.DIAG_28_AFREQ,
			c.DIAG_29_AFREQ,
			c.DIAG_30_AFREQ,
			c.DIAG_31_AFREQ,
			c.DIAG_32_AFREQ,
			c.DIAG_33_AFREQ,
			c.DIAG_34_AFREQ,
			c.DIAG_35_AFREQ,
			c.DIAG_36_AFREQ,
			c.DIAG_37_AFREQ,
			c.DIAG_38_AFREQ,
			c.DIAG_39_AFREQ,
			c.DIAG_40_AFREQ,
			c.DIAG_41_AFREQ,
			c.DIAG_42_AFREQ,
			c.DIAG_43_AFREQ,
			c.DIAG_44_AFREQ,
			c.DIAG_45_AFREQ,
			c.DIAG_46_AFREQ,
			c.DIAG_47_AFREQ,
			c.DIAG_48_AFREQ,
			c.DIAG_49_AFREQ,
			c.DIAG_50_AFREQ,
			c.DIAG_51_AFREQ,
			c.DIAG_52_AFREQ,
			c.DIAG_53_AFREQ,
			c.DIAG_54_AFREQ,
			c.DIAG_55_AFREQ,
			c.DIAG_56_AFREQ,
			c.DIAG_57_AFREQ,
			c.DIAG_58_AFREQ,
			c.PRC_59_AFREQ,
			c.PRC_60_AFREQ,
			c.PRC_61_AFREQ,
			c.PRC_62_AFREQ,
			c.PRC_63_AFREQ,
			c.PRC_64_AFREQ,
			c.PRC_65_AFREQ,
			c.PRC_66_AFREQ,
			c.RX_67_AFREQ,
			c.RX_68_AFREQ,
			c.RX_69_AFREQ,
			c.RX_70_AFREQ,
			c.RX_71_AFREQ,
			c.RX_72_AFREQ,
			c.RX_73_AFREQ,
			c.RX_74_AFREQ,
			c.RX_75_AFREQ,
			c.RX_76_AFREQ,
			c.RX_77_AFREQ,
			c.RX_78_AFREQ,
			c.GENDERM,
			c.AGE,
			c.lookback_days,
			c.ER_FREQ,
			c.ER_AFREQ,
			c.ER_FLAG,
			"I3" as datasource from outdir.Datset_i3 c;
quit;

/*Some qc*/
proc sql;
create table outdir.qc_dataset_ii as
	select datasource, count(*) as cnt, min(age) as minage, max(age) as maxage from outdir.Dataset_ii
	group by datasource;
quit;

proc contents data=outdir.Dataset_ii;
	ods output Variables = variables;
run;

data flag_variables;
	set variables;
	if kindex(Variable, "_FLAG") > 0;
	keep Variable;
run;

proc sql noprint;
	select Variable into :allvar separated " " from flag_variables;
quit;

%put &allvar;

/*Data Clean*/
data event_flag;
	set outdir.Dataset_ii(keep=&allvar datasource);
	_flag_cnt = sum(of &allvar);
	keep  datasource _flag_cnt;
run;

proc sql;
create table event_qc as
	select datasource, min(_flag_cnt) as minevent, max(_flag_cnt) as maxevent 
	from event_flag
	group by datasource;
quit;


proc sql;
	select distinct genderm from outdir.Dataset_ii;
quit;
/*0 1*/

proc sql;
create table outdir.qc_dataset_ii as
	select a.*,
			b.minevent,
			b.maxevent
	from  outdir.qc_dataset_ii a
	left join Event_qc b
	on a.datasource = b.datasource;
quit;

